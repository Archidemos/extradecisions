# -*- ck2.events -*-

namespace = emf_startup

# emf_startup.0
#
# Main EMF campaign initialization event, fired from on_startup [Isis]
character_event = {
	id = emf_startup.0
	hide_window = yes
	is_triggered_only = yes

	religion = hip_religion

	trigger = {
		has_landed_title = e_hip
		is_save_game = no
	}

	immediate = {
		# The EMF flag should not be set until this event is done.
		# The EMF_prestartup flag is set via title history if the HIP installer was used to compile EMF, however.
		if = {
			limit = { has_global_flag = EMF }
			log = "CRITICAL ERROR: emf_startup.0: global flag EMF was already set before startup event; aborting game after error event!"
			any_player = { narrative_event = { id = emf_startup.2 } }
			break = yes
		}

		set_global_flag = emf_game_start_v11_1_BETA # SAVE-COMPAT / FIXME / TODO: CHANGE UPON RELEASE

		# Initialize genetics on randomly-generated rulers:
		character_event = { id = emf_dna.0 }

		if = {
			limit = { is_alternate_start = no }
			k_magyar = { set_flag = emf_autodestroy_exemption }
		}

		# Run the [unnecessary] titular title autodestruction code upon every playable ruler now
		any_playable_ruler = {
			limit = {
				ai = yes
				war = no
			}
			character_event = { id = emf_core.100 }
		}

		# Combat & diplo trait distribution
		any_character = {
			character_event = { id = emf_startup.10 }
			character_event = { id = emf_startup.11 }
		}

		# Primary startup is done, so we raise the EMF flag.
		set_global_flag = EMF
	}
}

# emf_startup.10 [Any Character]
#
# Combat trait distribution
character_event = {
	id = emf_startup.10

	hide_window = yes
	is_triggered_only = yes

	min_age = 16

	trigger = {
		has_warrior_skill_trigger = no
		OR = {
			is_playable = yes
			can_be_marshal_trigger = yes
		}
		OR = {
			has_education_martial_trigger = yes
			has_lifestyle_martial_trigger = yes
			has_job_title = job_marshal
			has_minor_title = title_commander
		}
	}

	immediate = {
		if = {
			limit = { trait = misguided_warrior }
			isis = { change_variable = { which = combat_skill value = 2 } }
		}
		if = {
			limit = { trait = tough_soldier }
			isis = { change_variable = { which = combat_skill value = 4 } }
		}
		if = {
			limit = { trait = skilled_tactician }
			isis = { change_variable = { which = combat_skill value = 6 } }
		}
		if = {
			limit = { trait = brilliant_strategist }
			isis = { change_variable = { which = combat_skill value = 8 } }
		}
		if = {
			limit = { trait = diligent }
			isis = { change_variable = { which = combat_skill value = 1 } }
		}
		if = {
			limit = { trait = brave }
			isis = { change_variable = { which = combat_skill value = 2 } }
		}
		if = {
			limit = { is_smart_trigger = yes }
			isis = { change_variable = { which = combat_skill value = 1 } }
		}
		if = {
			limit = { trait = genius }
			isis = { change_variable = { which = combat_skill value = 2 } }
		}
		if = {
			limit = { trait = strong }
			isis = { change_variable = { which = combat_skill value = 2 } }
		}
		if = {
			limit = { trait = robust }
			isis = { change_variable = { which = combat_skill value = 2 } }
		}
		if = {
			limit = { trait = agile }
			isis = { change_variable = { which = combat_skill value = 1 } }
		}
		if = {
			limit = { is_weak_trigger = yes }
			isis = { change_variable = { which = combat_skill value = -2 } }
		}
		if = {
			limit = { trait = slow }
			isis = { change_variable = { which = combat_skill value = -1 } }
		}
		if = {
			limit = { trait = dull }
			isis = { change_variable = { which = combat_skill value = -1 } }
		}
		if = {
			limit = { trait = imbecile }
			isis = { change_variable = { which = combat_skill value = -3 } }
		}
		if = {
			limit = { trait = inbred }
			isis = { change_variable = { which = combat_skill value = -2 } }
		}
		if = {
			limit = { trait = clubfooted }
			isis = { change_variable = { which = combat_skill value = -1 } }
		}
		if = {
			limit = { trait = slothful }
			isis = { change_variable = { which = combat_skill value = -1 } }
		}
		if = {
			limit = { trait = craven }
			isis = { change_variable = { which = combat_skill value = -2 } }
		}
		if = {
			limit = { trait = impaler }
			isis = { change_variable = { which = combat_skill value = 1 } }
		}
		if = {
			limit = { trait = duelist }
			isis = { change_variable = { which = combat_skill value = 3 } }
		}
		if = {
			limit = {
				isis = { check_variable = { which = combat_skill value = 8 } }
			}
			add_trait = master_warrior
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = combat_skill value = 6 } }
			}
			add_trait = skilled_warrior
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = combat_skill value = 4 } }
			}
			add_trait = trained_warrior
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = combat_skill value = 1 } }
			}
			add_trait = poor_warrior
		}
	}

	option = {
		name = OK
		isis = { set_variable = { which = combat_skill value = 0 } }
	}
}

# emf_startup.11 [Any Character]
# Diplomat trait distribution
character_event = {
	id = emf_startup.11

	hide_window = yes
	is_triggered_only = yes

	min_age = 16

	trigger = {
		has_diplomat_skill_trigger = no
		OR = {
			is_playable = yes
			can_be_chancellor_trigger = yes
		}
		OR = {
			has_education_diplomacy_trigger = yes
			has_lifestyle_diplomacy_trigger = yes
			has_job_title = job_chancellor
		}
	}

	immediate = {
		if = {
			limit = { trait = naive_appeaser }
			isis = { change_variable = { which = diplomat_skill value = 2 } }
		}
		if = {
			limit = { trait = underhanded_rogue }
			isis = { change_variable = { which = diplomat_skill value = 4 } }
		}
		if = {
			limit = { trait = charismatic_negotiator }
			isis = { change_variable = { which = diplomat_skill value = 6 } }
		}
		if = {
			limit = { trait = grey_eminence }
			isis = { change_variable = { which = diplomat_skill value = 8 } }
		}
		if = {
			limit = { trait = gregarious }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = charitable }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { is_smart_trigger = yes }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = genius }
			isis = { change_variable = { which = diplomat_skill value = 2 } }
		}
		if = {
			limit = { trait = diligent }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = patient }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = deceitful }
			isis = { change_variable = { which = diplomat_skill value = -2 } }
		}
		if = {
			limit = { trait = honest }
			isis = { change_variable = { which = diplomat_skill value = 2 } }
		}
		if = {
			limit = { trait = slow }
			isis = { change_variable = { which = diplomat_skill value = -1 } }
		}
		if = {
			limit = { trait = dull }
			isis = { change_variable = { which = diplomat_skill value = -1 } }
		}
		if = {
			limit = { trait = imbecile }
			isis = { change_variable = { which = diplomat_skill value = -3 } }
		}
		if = {
			limit = { trait = shy }
			isis = { change_variable = { which = diplomat_skill value = -2 } }
		}
		if = {
			limit = { trait = trusting }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = tall }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = melodious_voice }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = powerful_voice }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = calm_voice }
			isis = { change_variable = { which = diplomat_skill value = 1 } }
		}
		if = {
			limit = { trait = paranoid }
			isis = { change_variable = { which = diplomat_skill value = -1 } }
		}
		if = {
			limit = { trait = cruel }
			isis = { change_variable = { which = diplomat_skill value = -1 } }
		}
		if = {
			limit = { trait = deaf }
			isis = { change_variable = { which = diplomat_skill value = -2 } }
		}
		if = {
			limit = {
				isis = { check_variable = { which = diplomat_skill value = 8 } }
			}
			add_trait = master_diplomat
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = diplomat_skill value = 6 } }
			}
			add_trait = skilled_diplomat
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = diplomat_skill value = 4 } }
			}
			add_trait = trained_diplomat
			break = yes
		}
		if = {
			limit = {
				isis = { check_variable = { which = diplomat_skill value = 1 } }
			}
			add_trait = novice_diplomat
		}
	}

	option = {
		name = OK
		isis = { set_variable = { which = diplomat_skill value = 0 } }
	}
}
