namespace = ARPLT

# Ultimatum - Independence

letter_event = {
	id = ARPLT.1
	desc = "EVTDESCAR1"
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { in_faction = faction_dissolution }
	}
	
	immediate = {
		FROM = { 
			diplomatic_immunity = yes 
			any_faction_backer = {
				faction = faction_dissolution
				diplomatic_immunity = yes
			}
		}
	}
	
	option = {
		name = "EVTOPTA8000" # Fold to demand
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0			
				NOT = {
					FROM = {
						faction_power = 
						{
							faction = faction_dissolution
							power = 1.0
						}
					}
				}
			}
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
			modifier = {
				factor = 0.001
				FROM = {
					NOT = {
						faction_power = 
						{
							faction = faction_dissolution
							power = 0.25
						}
					}
				}
			}
		}
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					ai = no
					NOT = { in_faction = faction_dissolution }
				}
				character_event = { id = ARPLT.3 }
			}
			FROM = {
				letter_event = { id = 8069 }
				any_faction_backer = {
					faction = faction_dissolution
					letter_event = { id = ARPLT.4 }
					diplomatic_immunity = no
				}
				diplomatic_immunity = no
			}
		}
		#FROM = {
		#	show_scope_change = no
		#	any_faction_backer = {
		#		show_scope_change = no
		#		faction = faction_dissolution
		#		set_defacto_liege = THIS
		#	}
		#	unsafe_destroy_landed_title = THIS
		#}
		ROOT = {
			any_demesne_title = {
				unsafe_destroy_landed_title = THIS
			}
		}
		FROM = {
			show_scope_change = no
			opinion = {
				modifier = opinion_granted_independence
				who = ROOT
				months = 120
			}
		}
	}
	option = {
		name = "EVTOPTB8000" # War!
		
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				FROM = {
					faction_power = 
					{
						faction = faction_dissolution
						power = 1.5
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_dissolution
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_dissolution
						power = 2.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_dissolution
						power = 3.0
					}
				}
			}	
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_dissolution
						power = 4.0
					}
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { faction_power = { faction = faction_dissolution power = 1.0 } }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the liege's banner
				}
			}
		}
		
		FROM = {
			letter_event = { id = ARPLT.2 days = 3 tooltip = "EVTTOOLTIP8100" }
			tooltip = {
				any_faction_backer = {
					faction = faction_dissolution
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						faction_power = { faction = faction_dissolution power = 0.33 }
						NOT = { faction_power = { faction = faction_dissolution power = 0.75 } }
					}
					random_list = {
						50 = {
						}
						15 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						35 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
				if = {
					limit = {
						faction_power = { faction = faction_dissolution power = 0.75 }
						NOT = { faction_power = { faction = faction_dissolution power = 1.5 } }
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
			}
		}
	}
}

# Demand rejected - Independence
letter_event = {
	id = ARPLT.2
	desc = "EVTDESCAR2"
	
	is_triggered_only = yes
	
	option = {
		name = "Then war it is!"
		
		clr_character_flag = faction_dissolution_ultimatum_taken
		
		war = {
			target = FROM
			casus_belli = cb_faction_dissolution
			faction = faction_dissolution
		}
	}
}

# Inform other vassals - Independence
character_event = {
	id = ARPLT.3
	desc = "EVTDESCAR3"
	
	picture = GFX_evt_council
	border = GFX_event_normal_frame_intrigue
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "I_SEE"
	}
}

letter_event = {
	id = ARPLT.4
	desc = "EVTDESCAR4"
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_demesne_title = {
			limit = {
				controls_religion = no
				higher_tier_than = BARON
				FROM = {
					OR = { # If the old liege can use the subjugation CB, give no claims
						NOT = { religion_group = pagan_group }
						NOT = { culture_group = ROOT }
					}
				}
			}
			add_weak_pressed_claim = FROM
		}
	}
	
	option = {
		name = "GOOD"
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROMFROM
			years = 5
		}
		opinion = {
			modifier = opinion_granted_dissolution
			who = FROM
			months = 120
		}
	}
}

# Demand accepted - Independence
letter_event = {
	id = ARPLT.5
	desc = "EVTDESCAR5"
	
	is_triggered_only = yes
	
	immediate = {
		any_demesne_title = {
			limit = {
				controls_religion = no
				higher_tier_than = BARON
				FROM = {
					OR = { # If the old liege can use the subjugation CB, give no claims
						NOT = { religion_group = pagan_group }
						NOT = { culture_group = ROOT }
					}
				}
			}
			add_weak_pressed_claim = FROM
		}
	}
	
	option = {
		name = "EXCELLENT"
		clr_character_flag = faction_dissolution_ultimatum_taken
	}
}